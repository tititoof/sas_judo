{"changed":true,"filter":false,"title":"edit.vue","tooltip":"/resources/assets/js/components/admin/articles/edit.vue","value":"<template>\n    <div class=\"col-xs-12\">\n        <h1>\n            Editer article\n            <small>\n                <ui-button\n                        type=\"secondary\" color=\"accent\" size=\"large\"\n                        @click.prevent=\"update()\">\n                    Modifier\n                </ui-button>\n            </small>\n        </h1>\n        <ui-select\n                name=\"categories\" label=\"Menus\"\n                :options=\"allMenus\"\n                v-model=\"menus\"\n                placeholder=\"Choisir le ou les menus\" show-search multiple z-index=\"1\"\n        ></ui-select>\n        <ui-textbox\n                label=\"Nom\" name=\"name\" type=\"text\" placeholder=\"Entrer le nom de l'article\" v-model=\"name\"\n        >\n        </ui-textbox>\n        <quill ref=\"qc\"\n               :options=\"optionsEditor\">\n        </quill>\n        <ui-select\n            name=\"albums\" label=\"Albums\" placeholder=\"Choisir le ou les albums\" show-search multiple z-index=\"1\"\n            id=\"albums\"\n            v-model=\"albumsSelected\"\n            :options=\"albums\"\n            >\n        </ui-select>\n        <ui-button\n                type=\"secondary\" color=\"accent\" size=\"large\"\n                @click.prevent=\"addAlbum()\">\n            Ajouter un album\n        </ui-button>\n    </div>\n</template>\n<script>\n    import auth from '../../../auth';\n    import Keen from 'keen-ui';\n    import {app} from './../../../app.js';\n    import {router} from './../../../app.js';\n    import Quill from './../../editor/v-quill';\n    export default {\n        data() {\n            return {\n                auth:           auth,\n                articleId:      '',\n                name:           '',\n                menus:          [],\n                allMenus:       [],\n                content:        '',\n                albums:         [],\n                albumsDefault:  [],\n                albumsSelected: [],\n                optionsEditor: {\n                    modules: {\n                        toolbar: [\n                            ['bold', 'italic', 'underline', 'strike'],        // toggled buttons\n                            ['blockquote', 'code-block'],\n\n                            [{ 'header': 1 }, { 'header': 2 }],               // custom button values\n                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],\n                            [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript\n                            [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent\n                            [{ 'direction': 'rtl' }],                         // text direction\n\n                            [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown\n                            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\n                            [ 'link', 'image', 'video', 'formula' ],\n                            [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme\n                            [{ 'font': [] }],\n                            [{ 'align': [] }],\n                            ['clean']                                         // remove formatting button\n                        ],\n                    },\n                    theme: 'snow'\n                }\n            }\n        },\n        components: {\n            Quill\n        },\n        methods: {\n            index() {\n                const _self = this;\n                _self.$http.get('api/article/' +_self.articleId + '/edit').then(\n                    (response) => {\n                        const data        = response.data,\n                        const newAlbumId  = _self.$route.params.albumId;\n                        _self.name      = data.object.name;\n                        _self.content   = data.object.content;\n                        _self.$refs.qc.$el.querySelector('.ql-editor').innerHTML = _self.content;\n                        _self.allMenus  = data.menus;\n                        data.object.categories.forEach(function(category) {\n                            _self.menus.push({ 'label': category.name, 'value': category.id });\n                        });\n                        _self.albums = data.allAlbums;\n                        data.albums.forEach(function(album) {\n                            _self.albumsDefault.push({ 'label': album.name, 'value': album.id });\n                        });\n\n                        if (newAlbumId !== 0) {\n                            _self.albums.forEach(function(album) {\n                                if (newAlbumId == album.value) {\n                                    _self.albumsDefault.push({ 'label': album.name, 'value': album.id })\n                                }\n                            });\n                        }\n                    },\n                    (response) => {\n                        _self.$emit('sas-snackbar', 'Une erreur est survenue');\n                    });\n            },\n            update() {\n                const _self = this;\n                _self.send();\n            },\n            addAlbum() {\n                const _self = this;\n                _self.send(true);\n            },\n            send(newAlbum = false) {\n                const _self = this;\n                let categories  = [],\n                    albums      = [];\n                _self.content   = _self.$refs.qc.$el.querySelector('.ql-editor').innerHTML;\n                _self.menus.forEach(function(category) {\n                    categories.push(category.value);\n                });\n                _self.albumsSelected.forEach(function(album) {\n                    albums.push(album.value);\n                });\n                _self.$http.patch('api/article/' + _self.articleId, {\n                    'name': _self.name, 'categories': categories, 'content': _self.content,\n                    'user_id': auth.user.profile.id, 'albums': albums\n                }).then(\n                    (response) => {\n                        _self.$emit('sas-snackbar', 'Article modifiÃ©');\n                        if (newAlbum) {\n                            router.push({ name: 'admin_albums_new', params: { articleId: _self.articleId } });\n                        } else {\n                            router.push({ name: 'admin_articles_index' });\n                        }\n                    },\n                    (response) => {\n                        _self.$emit('sas-snackbar', 'Une erreur est survenue');\n                    }\n                );\n            }\n        },\n        mounted() {\n            this.$nextTick(function () {\n                const _self = this;\n                auth.check(_self);\n                _self.articleId = _self.$route.params.articleId;\n                _self.index();\n            });\n        },\n        onEditorBlur(editor) {\n            // console.log('editor blur!', editor)\n        },\n        onEditorFocus(editor) {\n            // console.log('editor focus!', editor)\n        },\n        onEditorReady(editor) {\n            // console.log('editor ready!', editor)\n        },\n        onEditorChange({ editor, html, text }) {\n            this.content = html\n        }\n    }\n</script>\n","undoManager":{"mark":8,"position":23,"stack":[[{"start":{"row":162,"column":12},"end":{"row":162,"column":15},"action":"insert","lines":["// "],"id":2}],[{"start":{"row":165,"column":12},"end":{"row":165,"column":15},"action":"insert","lines":["// "],"id":3}],[{"start":{"row":168,"column":12},"end":{"row":168,"column":15},"action":"insert","lines":["// "],"id":4}],[{"start":{"row":147,"column":35},"end":{"row":148,"column":0},"action":"insert","lines":["",""],"id":5},{"start":{"row":148,"column":0},"end":{"row":148,"column":24},"action":"insert","lines":["                        "]}],[{"start":{"row":148,"column":24},"end":{"row":148,"column":79},"action":"insert","lines":["_self.$emit('sas-snackbar', 'Une erreur est survenue');"],"id":6}],[{"start":{"row":149,"column":0},"end":{"row":150,"column":0},"action":"remove","lines":["                        console.log(response);",""],"id":7}],[{"start":{"row":112,"column":35},"end":{"row":113,"column":0},"action":"insert","lines":["",""],"id":8},{"start":{"row":113,"column":0},"end":{"row":113,"column":24},"action":"insert","lines":["                        "]}],[{"start":{"row":113,"column":24},"end":{"row":113,"column":79},"action":"insert","lines":["_self.$emit('sas-snackbar', 'Une erreur est survenue');"],"id":9}],[{"start":{"row":114,"column":0},"end":{"row":115,"column":0},"action":"remove","lines":["                        console.log(response);",""],"id":10}],[{"start":{"row":90,"column":24},"end":{"row":90,"column":27},"action":"remove","lines":["let"],"id":11},{"start":{"row":90,"column":24},"end":{"row":90,"column":25},"action":"insert","lines":["c"]}],[{"start":{"row":90,"column":25},"end":{"row":90,"column":26},"action":"insert","lines":["o"],"id":12}],[{"start":{"row":90,"column":26},"end":{"row":90,"column":27},"action":"insert","lines":["n"],"id":13}],[{"start":{"row":90,"column":27},"end":{"row":90,"column":28},"action":"insert","lines":["s"],"id":14}],[{"start":{"row":90,"column":28},"end":{"row":90,"column":29},"action":"insert","lines":["t"],"id":15}],[{"start":{"row":91,"column":24},"end":{"row":91,"column":25},"action":"insert","lines":["c"],"id":16}],[{"start":{"row":91,"column":25},"end":{"row":91,"column":26},"action":"insert","lines":["o"],"id":17}],[{"start":{"row":91,"column":26},"end":{"row":91,"column":27},"action":"insert","lines":["n"],"id":18}],[{"start":{"row":91,"column":27},"end":{"row":91,"column":28},"action":"insert","lines":["s"],"id":19}],[{"start":{"row":91,"column":28},"end":{"row":91,"column":29},"action":"insert","lines":["t"],"id":20}],[{"start":{"row":91,"column":29},"end":{"row":91,"column":30},"action":"insert","lines":[" "],"id":21}],[{"start":{"row":91,"column":30},"end":{"row":91,"column":31},"action":"remove","lines":[" "],"id":22}],[{"start":{"row":91,"column":30},"end":{"row":91,"column":31},"action":"remove","lines":[" "],"id":23}],[{"start":{"row":91,"column":30},"end":{"row":91,"column":31},"action":"remove","lines":[" "],"id":24}],[{"start":{"row":91,"column":30},"end":{"row":91,"column":31},"action":"remove","lines":[" "],"id":25}]]},"ace":{"folds":[],"scrolltop":1740,"scrollleft":0,"selection":{"start":{"row":112,"column":30},"end":{"row":112,"column":30},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":41,"state":"js-start","mode":"ace/mode/html"}},"timestamp":1500102458428}